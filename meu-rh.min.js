var debugScript=!0;function router(){console.log("checking cjs : meu-rh.js"),window.location.href.includes("/clockings")?(console.log("includes /clockings"),waitFor(()=>$("#table-timesheet")[0],()=>readHours())):console.log("unknow page, ignoring script")}function pad(t,n){for(t=t.toString();t.length<n;)t="0"+t;return t}function readHours(){var t=$("#table-timesheet").find("tr:first").find("th")[0].cloneNode(!0);for(var n of(t.children[0].innerHTML="Saldo",$("#table-timesheet").find("tr:first").append(t),$("#table-timesheet").find("tr")))if(n.children[1].children[0]&&n.children[1].children[0].children[0]){var e=[],i=$(n.children[1]).find("a");for(item of i)item.innerHTML.trim().length>0&&e.push(item.innerHTML.trim());var r=[];for(item of i=$(n.children[2]).find("a"))item.innerHTML.trim().length>0&&r.push(item.innerHTML.trim());e.length!=r.length?includeAddAppointmentButton(n,e,r):1==e.length&&isMissingLunchBreak(e,r)?addLunchBreak(n,e,r):calculateHours(n,e,r)}}function includeAddAppointmentButton(t,n,e){if(getMinutesFromString(n[0])>660)addMorningAppointmentButton(t);else if(e.length>0){var i=getMinutesFromString(e[0])-getMinutesFromString(n[0]),r=getMinutesFromString(n[1])-getMinutesFromString(e[0]);i<90?addMorningAppointmentButton(t):r<90?addEveningAppointmentButton(t):i>r?addLunchBreakIn(t,e[0]):addLunchBreakReturn(t,e[0])}}function getMinutesFromString(t){let n=t.split(":");return 60*parseInt(n[0],10)+parseInt(n[1],10)}function getStringFromMinutes(t){let n=parseInt(t/60,10);return formatIntAsString(n)+":"+formatIntAsString(t-60*n)}function calculateHours(t,n,e){let i=0;for(var r=0;r<n.length;r++)i+=getMinutesFromString(e[r])-getMinutesFromString(n[r]);if(i>0){let o=$(t).find("td")[0].cloneNode(!0);o.children[0].children[0].innerHTML=i-510;let a=parseInt(i/60);o.children[2].innerHTML=pad(a,2)+":"+pad(i-60*a,2),o.children[3].remove(),$(t).append(o)}}function addAppointment(t,n,e,i){var r=getDateFromLine(t);let o={date:r,direction:n,hour:6e4*getMinutesFromString(e),referenceDate:r,justify:i||"expediente",origin:"manual"};console.dir(o),$.ajax({url:"/rm/api/rest/timesheet/clocking/%7Bcurrent%7D",async:!1,type:"POST",contentType:"application/json",data:JSON.stringify(o),success:t=>console.log(t),error:t=>console.dir(t)})}function waitFor(t,n){debugScript&&console.log("waiting");var e=setInterval(()=>{if(t()){debugScript&&console.log("done, loading"),clearInterval(e),n();return}debugScript&&console.log("waiting")},300)}isMissingLunchBreak=(t,n)=>getMinutesFromString(n[0])-getMinutesFromString(t[0])>360,randomId=()=>(Math.random()+1).toString(36).substring(5),addMorningAppointmentButton=t=>addButton(t,"Adiciona entrada \xe0s 8h",()=>addAppointment(t,"entry","08:00")),addEveningAppointmentButton=t=>addButton(t,"Adiciona sa\xedda \xe0s 18h",()=>addAppointment(t,"exit","18:00")),addLunchBreakIn=(t,n)=>addButton(t,"Adiciona sa\xedda para o almo\xe7o",()=>addAppointment(t,"exit",subtractHour(n))),addLunchBreakReturn=(t,n)=>addButton(t,"Adiciona volta do almo\xe7o",()=>addAppointment(t,"entry",addHour(n))),addLunchBreak=(t,n,e)=>{let i=getMinutesFromString(n[0]),r=getMinutesFromString(e[0])-i,o=getStringFromMinutes(i+=r/2-30);addButton(t,"Adiciona almo\xe7o",()=>{addAppointment(t,"exit",o),addAppointment(t,"entry",addHour(o))})},addHour=t=>{let n=t.split(":");return formatIntAsString(parseInt(n[0],10)+1)+":"+n[1]},subtractHour=t=>{let n=t.split(":");return formatIntAsString(parseInt(n[0],10)-1)+":"+n[1]},addButton=(t,n,e)=>{let i=randomId();$(t).append('<button type="button" id="'+i+'" class="po-button po-text-ellipsis"><po-icon class="po-button-icon"><i aria-hidden="true" class="po-icon po-icon-plus"></i></po-icon><span class="po-button-label">'+n+"</span></button>"),$("#"+i).on("click",()=>$("#"+i).remove()),$("#"+i).on("click",e)},formatIntAsString=t=>t<9?"0"+t:t,getDateFromLine=t=>{let n=$(t).find("a")[0].innerHTML.split("/"),e=new Date().getFullYear();return 0==new Date().getMonth()&&12==parseInt(n[1],10)&&e--,e+"-"+n[1]+"-"+n[0]+"T03:00:00.000Z"},router();
